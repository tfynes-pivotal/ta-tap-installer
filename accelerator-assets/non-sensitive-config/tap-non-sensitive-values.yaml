#@ load("@ytt:data", "data")
---
tap_install:
  values: 
        excluded_packages: []
        shared:
          #@ if data.values.customCaCertsProvided:
          ca_cert_data: #@ data.values.caCerts
          #@ end


          ingress_domain: #@ data.values.tapIngressDomain
          #@ if data.values.tlsMode == 'tlsManual':
          ingress_issuer: ""
          #@ else:
          ingress_issuer: "letsencrypt-production" 
          #@ end

        ceip_policy_disclosed: true
        profile: run
        #! supply_chain: testing_scanning
        supply_chain: basic

        contour:
          envoy:
            service:
              type: LoadBalancer 

        appliveview_connector:
          backend:
            sslDeactivated: false
            ingressEnabled: true
            host: #@ "appliveview." + data.values.tapIngressDomain

        amr:
          observer:
            auth:
              kubernetes_service_accounts:
                enable: true
            cloudevent_handler:
              endpoint: #@ "https://amr-cloudevent-handler." + data.values.tapFullViewClusterIngressDomain
            #! ca_cert_data: |
        

        cnrs:
          domain_template: '{{.Name}}-{{.Namespace}}.{{.Domain}}'
          #@ if data.values.tlsMode == 'tlsManual':
          default_tls_secret: tanzu-system-ingress/taptlscert
          #@ end

        namespace_provisioner:
          controller: false
          gitops_install:
            ref: origin/akslab
            subPath: clusters/taplab/cluster-config/namespaces
            url: #@ data.values.tapGitopsInstallationRepositoryUrl
            secretRef:
              name: git-auth
              namespace: tap-install
              create_export: true
          additional_sources:
          - git:
              ref: origin/akslab
              subPath: clusters/taplab/cluster-config/namespaces/namespace-resources
              url: #@ data.values.tapGitopsInstallationRepositoryUrl
              secretRef:
                name: git-auth-install
                namespace: tap-install
                create_export: true
            path: _ytt_lib/namespace-resources
          default_parameters:
            supply_chain_service_account:
              secrets:
              - workload-git-auth
